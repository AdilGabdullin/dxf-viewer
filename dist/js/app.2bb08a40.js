(function(e){function t(t){for(var i,n,a=t[0],l=t[1],c=t[2],d=0,p=[];d<a.length;d++)n=a[d],Object.prototype.hasOwnProperty.call(r,n)&&r[n]&&p.push(r[n][0]),r[n]=0;for(i in l)Object.prototype.hasOwnProperty.call(l,i)&&(e[i]=l[i]);u&&u(t);while(p.length)p.shift()();return o.push.apply(o,c||[]),s()}function s(){for(var e,t=0;t<o.length;t++){for(var s=o[t],i=!0,a=1;a<s.length;a++){var l=s[a];0!==r[l]&&(i=!1)}i&&(o.splice(t--,1),e=n(n.s=s[0]))}return e}var i={},r={app:0},o=[];function n(t){if(i[t])return i[t].exports;var s=i[t]={i:t,l:!1,exports:{}};return e[t].call(s.exports,s,s.exports,n),s.l=!0,s.exports}n.m=e,n.c=i,n.d=function(e,t,s){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},n.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(n.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(s,i,function(t){return e[t]}.bind(null,i));return s},n.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="/bim/dxf/";var a=window["webpackJsonp"]=window["webpackJsonp"]||[],l=a.push.bind(a);a.push=t,a=a.slice();for(var c=0;c<a.length;c++)t(a[c]);var u=l;o.push([1,"chunk-vendors"]),s()})({0:function(e,t){},"01dd":function(e,t,s){e.exports=s.p+"fonts/NotoSansDisplay-SemiCondensedLightItalic.b541af1f.ttf"},1:function(e,t,s){e.exports=s("56d7")},"17aa":function(e,t,s){"use strict";s("a3a8")},2891:function(e,t,s){e.exports=s.p+"fonts/Roboto-LightItalic.d1efcd4d.ttf"},3e3:function(e,t,s){"use strict";s("568a")},"487c":function(e,t,s){},"568a":function(e,t,s){},"56d7":function(e,t,s){"use strict";s.r(t);var i=s("2b0e"),r=function(){var e=this,t=e._self._c;return t("q-layout",{attrs:{view:"hHh lpr fff","data-nosnippet":""}},[t("q-header",[t("q-toolbar",[t("q-toolbar-title",{attrs:{shrink:!0}},[e._v("DXF viewer")]),t("q-file",{staticClass:"q-ml-xl",staticStyle:{"max-width":"300px",display:"none"},attrs:{color:"white","label-color":"white",filled:"","bottom-slots":"",clearable:"",dense:"",value:e.inputFile,label:"Select file or drag here",accept:".dxf",dark:""},on:{input:e._OnFileSelected,clear:e._OnFileCleared},scopedSlots:e._u([{key:"before",fn:function(){return[t("q-icon",{attrs:{name:"folder_open",color:"white"}})]},proxy:!0},{key:"hint",fn:function(){return[t("span",{staticClass:"text-white"},[e._v("File is processed locally in your browser")])]},proxy:!0},{key:"after",fn:function(){return[t("q-btn",{attrs:{dense:"",flat:"",label:"URL"},on:{click:function(t){e.urlDialog=!0}}})]},proxy:!0}])}),t("q-toolbar-title",{attrs:{shrink:!0}},[t("span",{domProps:{innerHTML:e._s(e.temp)}})]),t("q-space"),t("q-btn",{staticClass:"q-ml-lg",attrs:{icon:"help",label:"About"},on:{click:function(t){e.aboutDialog=!0}}}),t("q-btn",{staticClass:"q-mx-sm github",staticStyle:{display:"none"},attrs:{icon:"fab fa-github",color:"primary",label:"dxf-viewer on GitHub","no-caps":"",type:"a",href:"https://github.com/vagran/dxf-viewer"}}),t("q-btn",{staticClass:"q-mx-sm github",staticStyle:{display:"none"},attrs:{icon:"fab fa-github",color:"primary",label:"This example on GitHub","no-caps":"",type:"a",href:"https://github.com/vagran/dxf-viewer-example-src"}})],1)],1),t("q-page-container",[t("ViewerPage",{ref:"viewerPage",attrs:{dxfUrl:e.dxfUrl}},[null===e.inputFile?t("div",{staticClass:"centralUploader row justify-center items-center"},[t("div",{staticClass:"col-auto",staticStyle:{width:"300px"}},[t("q-file",{staticClass:"col",attrs:{filled:"","bottom-slots":"",clearable:"",value:e.inputFile,label:"Select file or drag here",accept:".dxf"},on:{input:e._OnFileSelected,clear:e._OnFileCleared},scopedSlots:e._u([{key:"before",fn:function(){return[t("q-icon",{attrs:{name:"folder_open",size:"xl"}})]},proxy:!0},{key:"hint",fn:function(){return[t("span",[e._v("File is processed locally in your browser")])]},proxy:!0}],null,!1,935147319)})],1),t("div",{staticClass:"col-auto q-mx-lg q-pb-lg"},[t("q-btn",{staticStyle:{display:"none"},attrs:{label:"Load URL"},on:{click:function(t){e.urlDialog=!0}}})],1)]):e._e()])],1),t("q-dialog",{model:{value:e.aboutDialog,callback:function(t){e.aboutDialog=t},expression:"aboutDialog"}},[t("q-card",[t("q-card-section",{staticClass:"row items-center q-pb-sm"},[t("div",{staticClass:"text-h6"},[e._v("About")]),t("q-space"),t("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{icon:"close",flat:"",round:"",dense:""}})],1),t("q-separator"),t("q-card-section",{staticClass:"scroll",staticStyle:{"max-height":"50vh"},domProps:{innerHTML:e._s(e.aboutHtml)}})],1)],1),t("q-dialog",{model:{value:e.urlDialog,callback:function(t){e.urlDialog=t},expression:"urlDialog"}},[t("q-card",[t("q-card-section",{staticClass:"row items-center q-pb-sm"},[t("div",{staticClass:"text-h6"},[e._v("Load URL")]),t("q-space"),t("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{icon:"close",flat:"",round:"",dense:""}})],1),t("q-separator"),t("q-card-section",[t("div",{staticClass:"q-mb-lg"},[t("a",{attrs:{href:"https://startpage.com/sp/search?q=SECTION%20HEADER%20filetype:dxf",target:"_blank"}},[e._v("Find some examples")])]),t("q-form",{staticClass:"q-gutter-md",staticStyle:{width:"400px"},on:{submit:e._OnUrl}},[t("q-input",{attrs:{filled:"",label:"Input URL here","bottom-slots":""},scopedSlots:e._u([{key:"hint",fn:function(){return[t("span",[e._v("Uses "),t("a",{attrs:{href:"https://allorigins.win"}},[e._v("AllOrigins")]),e._v(" CORS proxy")])]},proxy:!0}]),model:{value:e.inputUrl,callback:function(t){e.inputUrl=t},expression:"inputUrl"}}),t("div",[t("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{label:"Submit",type:"submit",color:"primary"}})],1)],1)],1)],1)],1)],1)},o=[],n=function(){var e=this,t=e._self._c;return t("q-page",{staticClass:"row items-stretch root"},[t("div",{staticClass:"col relative-position"},[e._t("default"),t("DxfViewer",{ref:"viewer",attrs:{dxfUrl:e.dxfUrl,fonts:e.fonts},on:{"dxf-loaded":e._OnLoaded,"dxf-cleared":e._OnCleared,"dxf-message":e._OnMessage}})],2),t("div",{staticClass:"col-auto layersCol"},[t("LayersList",{attrs:{layers:e.layers},on:{toggleLayer:e._OnToggleLayer,toggleAll:e._OnToggleAll}})],1)])},a=[],l=function(){var e=this,t=e._self._c;return t("div",{ref:"canvasContainer",staticClass:"canvasContainer"},[t("q-inner-loading",{staticStyle:{"z-index":"10"},attrs:{showing:e.isLoading,color:"primary"}}),null!==e.progress?t("div",{staticClass:"progress"},[t("q-linear-progress",{attrs:{color:"primary",indeterminate:e.progress<0,value:e.progress}}),null!==e.progressText?t("div",{staticClass:"progressText"},[e._v(e._s(e.progressText))]):e._e()],1):e._e(),null!==e.error?t("div",{staticClass:"error",attrs:{title:e.error}},[t("q-icon",{staticClass:"text-red",staticStyle:{"font-size":"4rem"},attrs:{name:"warning"}}),e._v(" Error occurred: "+e._s(e.error)+" ")],1):e._e()],1)},c=[],u=s("c686"),d=s("5a89");function p(){return new Worker(s.p+"js/DxfViewerWorker.4ef90ca2.worker.js")}var h={name:"DxfViewer",props:{dxfUrl:{default:null},fonts:{default:null},options:{default(){return{clearColor:new d["d"]("#fff"),autoResize:!0,colorCorrection:!0}}}},data(){return{isLoading:!1,progress:null,progressText:null,curProgressPhase:null,error:null}},watch:{async dxfUrl(e){null!==e?await this.Load(e):(this.dxfViewer.Clear(),this.error=null,this.isLoading=!1,this.progress=null)}},methods:{async Load(e){this.isLoading=!0,this.error=null;try{await this.dxfViewer.Load({url:e,fonts:this.fonts,progressCbk:this._OnProgress.bind(this),workerFactory:p})}catch(t){console.warn(t),this.error=t.toString()}finally{this.isLoading=!1,this.progressText=null,this.progress=null,this.curProgressPhase=null}},GetViewer(){return this.dxfViewer},_OnProgress(e,t,s){if(e!==this.curProgressPhase){switch(e){case"font":this.progressText="Fetching fonts...";break;case"fetch":this.progressText="Fetching file...";break;case"parse":this.progressText="Parsing file...";break;case"prepare":this.progressText="Preparing rendering data...";break}this.curProgressPhase=e}this.progress=null===s?-1:t/s}},mounted(){this.dxfViewer=new u["a"](this.$refs.canvasContainer,this.options);const e=e=>{this.dxfViewer.Subscribe(e,t=>this.$emit("dxf-"+e,t))};for(const t of["loaded","cleared","destroyed","resized","pointerdown","pointerup","viewChanged","message"])e(t)},destroyed(){this.dxfViewer.Destroy(),this.dxfViewer=null}},f=h,g=(s("f40b"),s("2877")),b=Object(g["a"])(f,l,c,!1,null,"43d73815",null),m=b.exports,y=s("2891"),v=s.n(y),x=s("01dd"),w=s.n(x),_=s("af29"),q=s.n(_),C=s("ee2f"),L=s.n(C),O=function(){var e=this,t=e._self._c;return t("q-scroll-area",{staticClass:"root"},[t("q-list",{attrs:{dense:""}},[t("q-item-label",{attrs:{header:""}},[e._v("Layers")]),null!==e.layers?t("q-item",{attrs:{tag:"label"}},[t("q-item-section",{attrs:{side:"",top:""}},[t("q-checkbox",{attrs:{value:e.showAll},on:{input:e._ToggleAll}})],1),t("q-item-section",[t("q-item-label",{staticClass:"text-italic"},[e._v("All layers")])],1)],1):e._e(),e._l(e.layers,(function(s){return null!==e.layers?t("q-item",{key:s.name,attrs:{tag:"label"}},[t("q-item-section",{staticClass:"q-pa-none",attrs:{side:""}},[t("q-icon",{style:{color:e._GetCssColor(s.color)},attrs:{name:"label"}})],1),t("q-item-section",{attrs:{side:"",top:""}},[t("q-checkbox",{attrs:{value:s.isVisible},on:{input:t=>e._ToggleLayer(s,t)}})],1),t("q-item-section",[t("q-item-label",[e._v(e._s(s.name))])],1)],1):e._e()}))],2)],1)},U=[],S={name:"LayersList",props:{layers:{type:Array,default:null}},watch:{layers(){this.showAll=null}},data(){return{showAll:null}},methods:{_ToggleLayer(e,t){this.$emit("toggleLayer",e,t),this.showAll=null},_ToggleAll(e){this.showAll=e,this.$emit("toggleAll",e)},_GetCssColor(e){let t=e.toString(16);while(t.length<6)t="0"+t;return"#"+t}}},P=S,k=(s("17aa"),Object(g["a"])(P,O,U,!1,null,"fe487658",null)),F=k.exports,T={name:"ViewerPage",components:{LayersList:F,DxfViewer:m},props:{dxfUrl:{type:String}},data(){return{layers:null}},methods:{_OnLoaded(){const e=this.$refs.viewer.GetViewer().GetLayers();e.forEach(e=>i["a"].set(e,"isVisible",!0)),this.layers=e},_OnCleared(){this.layers=null},_OnToggleLayer(e,t){e.isVisible=t,this.$refs.viewer.GetViewer().ShowLayer(e.name,t)},_OnToggleAll(e){if(this.layers)for(const t of this.layers)t.isVisible!==e&&this._OnToggleLayer(t,e)},_OnMessage(e){let t="info";switch(e.detail.level){case u["a"].MessageLevel.WARN:t="warning";break;case u["a"].MessageLevel.ERROR:t="negative";break}this.$q.notify({type:t,message:e.detail.message})}},created(){this.fonts=[v.a,w.a,q.a,L.a]}},R=T,D=(s("cd30"),Object(g["a"])(R,n,a,!1,null,"3ea4d6e6",null)),Q=D.exports;const A="green",j=10025880;class V{constructor(e){this.viewer=e,this.points=[],this.line=null,this.closed=!1,this.data={},this.pointerDown={},this.observers=[],this.initEvents()}subscribe(e){this.observers.push(e)}initEvents(){const{viewer:e}=this,t=e.GetCanvas();t.addEventListener("mousemove",e=>{const{x:s,y:i}=this.getWorldCoordinates(e.offsetX,e.offsetY),r=this.searchPoint(s,i);t.style.cursor=r?"pointer":"default"}),t.addEventListener("wheel",e=>{this.render()}),e.Subscribe("pointerdown",e=>{const{offsetX:t,offsetY:s}=e.detail.domEvent;this.pointerDown={x:t,y:s}}),e.Subscribe("pointerup",e=>{const{position:t,domEvent:s}=e.detail,{x:i,y:r}=t;if(this.isDragged(s))return;const o=s.button;0===o?this.onClick(i,r):2===o&&this.removeAllPoints(),this.render()})}isDragged(e){const{offsetX:t,offsetY:s}=e,i=t-this.pointerDown.x,r=s-this.pointerDown.y;return Math.abs(i)+Math.abs(r)>10}onClick(e,t){const s=this.searchPoint(e,t);null===s?this.addPoint(e,t):2===this.points.length?this.removeAllPoints():s!==this.points[0]||this.closed?this.removePoint(s):this.closed=!0}render(){this.updateColors(),this.updateLine(),this.updateData(),this.viewer.Render()}getRadius(){return this.viewer._CanvasToSceneCoord(5,0).x-this.viewer._CanvasToSceneCoord(0,0).x}addPoint(e,t){const{viewer:s,points:i}=this,r=new d["c"](this.getRadius(),32),o=new d["r"]({color:A}),n=new d["q"](r,o);n.position.x=e,n.position.y=t,i.push(n),s.scene.add(n)}removeAllPoints(){this.points.map(e=>this.viewer.scene.remove(e)),this.points=[],this.closed=!1}removePoint(e){this.viewer.scene.remove(e),this.points=this.points.filter(t=>t!==e),this.closed=!1}updateColors(){const{points:e,closed:t}=this;for(const s of e)s.material.color.set(A),s.geometry=new d["c"](this.getRadius(),32);!t&&e.length>0&&e[0].material.color.set(j)}updateLine(){const{viewer:e,points:t,line:s,closed:i}=this,r=e.scene,o=new d["m"]({color:A}),n=[...t,...i?[t[0]]:[]],a=(new d["b"]).setFromPoints(n.map(e=>e.position)),l=new d["l"](a,o);this.line=l,s&&r.remove(s),r.add(l)}updateData(){const e=(e,t)=>{const s=(e,t)=>{const s=e.position.x-t.position.x,i=e.position.y-t.position.y;return Math.sqrt(s*s+i*i)};let i=0;return e.forEach((t,r)=>{0!==r&&(i+=s(t,e[r-1]))}),t&&(i+=s(e.at(0),e.at(-1))),i},t=e=>{const t=e.map(e=>e.position);let s=0;for(let i=0,r=t.length;i<r;i++){const e=t[i].x,r=t[i==t.length-1?0:i+1].y,o=t[i==t.length-1?0:i+1].x,n=t[i].y;s+=e*r*.5,s-=o*n*.5}return Math.abs(s)},{points:s,observers:i,closed:r}=this,o=e(s,r),n=r?t(s):0;this.data={distance:o,area:n},i.forEach(e=>e(this.data))}getWorldCoordinates(e,t){return this.viewer._CanvasToSceneCoord(e,t)}searchPoint(e,t){const s=this.getRadius();for(const i of this.points){const r=e-i.position.x,o=t-i.position.y;if(r*r+o*o<s*s)return i}return null}}var E=V,M={components:{ViewerPage:Q},data(){return{dxfUrl:null,inputFile:null,isLocalFile:!1,aboutDialog:!1,urlDialog:!1,inputUrl:null,temp:""}},methods:{_OnFileSelected(e){e?(this.dxfUrl&&this.isLocalFile&&URL.revokeObjectURL(this.dxfUrl),this.isLocalFile=!0,this.inputFile=e,this.dxfUrl=URL.createObjectURL(e)):this._OnFileCleared()},_OnFileCleared(){this.inputFile&&(this.inputFile=null,URL.revokeObjectURL(this.dxfUrl),this.dxfUrl=null,this.$q.notify({type:"info",message:"File cleared"}))},_OnUrl(){if(null===this.inputUrl)return;const e=this.inputUrl.trim();""!==e&&(this.dxfUrl&&this.isLocalFile&&URL.revokeObjectURL(this.dxfUrl),this.isLocalFile=!1,this.inputFile=new File(["remote_file"],e,{type:"text/plain"}),this.dxfUrl="https://api.allorigins.win/raw?url="+encodeURIComponent(e))}},created(){const e=document.getElementById("about");this.aboutHtml=e.innerHTML,e.style.display="none",document.getElementById("noscript").innerText=e.innerText;const t=new URLSearchParams(window.location.search);if(!t.has("file"))return;const s=`./dxf/${t.get("file")}.dxf`;fetch(s).then(e=>e.text()).then(e=>{const t=new File([e],s,{type:"text/plain"});this.inputFile=t,this.isLocalFile=!0,this.dxfUrl=URL.createObjectURL(t)})},mounted(){const e=this.$refs.viewerPage.$refs.viewer.GetViewer();this.measurement=new E(e),this.measurement.subscribe(({distance:e,area:t})=>{this.temp=e?t?`ditance: ${e.toFixed(2)}m, area: ${t.toFixed(2)}m<sup>2</sup>`:`ditance: ${e.toFixed(2)}m`:""})},destroyed(){this.dxfUrl&&URL.revokeObjectURL(this.dxfUrl)}},$=M,I=(s("3000"),Object(g["a"])($,r,o,!1,null,"9178a496",null)),G=I.exports,H=(s("487c"),s("0ca9"),s("e54f"),s("573e"),s("fe09")),N=[H["D"],{components:{QBtn:H["c"],QCard:H["d"],QCardSection:H["e"],QCheckbox:H["f"],QDialog:H["g"],QFile:H["h"],QFooter:H["i"],QForm:H["j"],QHeader:H["k"],QIcon:H["l"],QInnerLoading:H["m"],QInput:H["n"],QItem:H["o"],QItemLabel:H["p"],QItemSection:H["q"],QLayout:H["r"],QLinearProgress:H["s"],QList:H["t"],QPage:H["u"],QPageContainer:H["v"],QScrollArea:H["w"],QSeparator:H["x"],QSpace:H["y"],QSpinner:H["z"],QToggle:H["A"],QToolbar:H["B"],QToolbarTitle:H["C"]},plugins:{Notify:H["b"],ClosePopup:H["a"]}}];i["a"].use(...N),new i["a"]({el:"#app",render:e=>e(G)})},a3a8:function(e,t,s){},af29:function(e,t,s){e.exports=s.p+"fonts/HanaMinA.b48893dc.ttf"},b35b:function(e,t,s){},cd30:function(e,t,s){"use strict";s("b35b")},dd66:function(e,t,s){},ee2f:function(e,t,s){e.exports=s.p+"fonts/NanumGothic-Regular.3cbe9257.ttf"},f40b:function(e,t,s){"use strict";s("dd66")}});
//# sourceMappingURL=app.2bb08a40.js.map